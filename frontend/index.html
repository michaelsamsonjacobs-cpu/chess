<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chess Observer</title>
  <link rel="icon" type="image/png" href="assets/favicon.png">
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="style_agent.css" />
</head>

<body>
  <div class="app-shell" id="app-shell" style="display: none;">
    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" id="mobile-menu-toggle" aria-label="Toggle menu">â˜°</button>
    <div class="sidebar-overlay" id="sidebar-overlay"></div>

    <!-- Sidebar Navigation -->
    <aside class="sidebar">
      <div class="sidebar-brand">
        <svg width="32" height="32" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" class="sidebar-logo">
          <path fill="white"
            d="M127.9 32.5c-4.8 0-9.6.9-14.1 2.8-19.1 7.9-26.6 29.8-17.7 48.6l.8 1.8 28.6 60.5C92.9 143.6 57 186.2 57 236c0 36.4 15.6 57.3 35.8 77.2 16.4 16.2 37.5 29.5 59.8 45.4 0 0 10.3 7.4 10.3 21.4 0 9.6-6.4 17.5-12.8 24.5-9.2 10-18.4 19.9-15.5 35.8 1.8 9.8 8.8 17.9 18.2 21.2 9.5 3.3 20.2 1.4 28.1-5.1 19.4-15.9 31.9-46.1 55.4-60.8 15.6-9.8 33.6-13.8 51.5-11.5 17.1 2.2 33.4 9.4 46.9 20.5 7.8 6.4 18.5 7.9 27.6 3.9 9.1-4.1 15-13.2 15-23.1V262.2C377.3 135.2 265.9 32.5 127.9 32.5zm0 40c49.3 0 94.6 18.2 130.6 48.2-12-16.1-36.9-38.3-70.3-43.7-18.7-3-38.9.7-55.9 9.7-11.8 6.3-8.8-11.3-4.4-14.2Z" />
          <path fill="white" d="M120 280c-13.3 0-24 10.7-24 24s10.7 24 24 24 24-10.7 24-24-10.7-24-24-24z" />
        </svg>
        <span class="brand-text">Chess Observer</span>
      </div>

      <nav class="sidebar-nav">
        <a href="#" class="nav-item active" data-section="dashboard-section">
          <span class="nav-icon">ğŸ“Š</span>
          <span class="nav-label">Dashboard</span>
        </a>
        <a href="#" class="nav-item" data-section="audit-search">
          <span class="nav-icon">ğŸ”</span>
          <span class="nav-label">Detective Mode</span>
        </a>
        <a href="#" class="nav-item" data-section="connection">
          <span class="nav-icon">ğŸ”—</span>
          <span class="nav-label">Link Account</span>
        </a>
        <a href="#" class="nav-item" data-section="reports">
          <span class="nav-icon">ğŸš¨</span>
          <span class="nav-label">Reports</span>
        </a>
        <a href="#" class="nav-item" data-section="agent-console">
          <span class="nav-icon">ğŸ¤–</span>
          <span class="nav-label">Agent Console</span>
        </a>
        <a href="#" class="nav-item" data-section="pricing-section">
          <span class="nav-icon">ğŸ’</span>
          <span class="nav-label">Pro</span>
        </a>
      </nav>

      <div class="sidebar-footer">
        <button id="logout-btn-side" class="logout-btn">
          <span>ğŸšª</span> Logout
        </button>
      </div>
    </aside>

    <!-- Main Content Area -->
    <main class="main-content">
      <!-- Analysis Dashboard -->
      <section class="content-section" id="dashboard-section">
        <header class="section-header">
          <h2>ğŸ“Š Analysis Dashboard</h2>
          <div class="header-actions">
            <button id="refresh-dashboard" class="secondary" onclick="loadDashboard()">â†» Refresh</button>
          </div>
        </header>

        <!-- Quick Player Search -->
        <div class="quick-search-container">
          <div class="search-input-wrapper">
            <input type="text" id="player-search" placeholder="ğŸ” Quick search: Is this player safe?"
              autocomplete="off" />
            <div class="search-results" id="search-results" style="display: none;"></div>
          </div>
          <small class="search-hint">Check if a player has been analyzed before</small>
        </div>

        <!-- Active Analyses Grid -->
        <div class="dashboard-grid-header">
          <h3>ğŸ”„ Active Analyses <span id="active-count">(0/9)</span></h3>
        </div>

        <div class="active-grid" id="active-analyses">
          <div class="active-card placeholder">
            <p>No active analyses</p>
            <small>Start auditing a player to begin</small>
          </div>
        </div>

        <!-- History Section -->
        <div class="history-section">
          <h3>ğŸ“œ Recent Investigations</h3>
          <div class="history-list" id="player-history">
            <p class="muted">No previous investigations</p>
          </div>
        </div>
      </section>

      <!-- Auditor Section (was Audit Search) -->
      <section class="content-section" id="audit-search" style="display: none;">
        <header class="section-header">
          <h2>ğŸ” Detective Mode</h2>
          <p class="section-desc">Audit any player from Lichess or Chess.com</p>
        </header>

        <div class="card auditor-card">
          <form id="audit-form">
            <div class="form-grid">
              <div class="field">
                <label for="audit-platform">Platform</label>
                <select id="audit-platform" name="platform">
                  <option value="chesscom">Chess.com</option>
                  <option value="lichess">Lichess</option>
                </select>
              </div>
              <div class="field">
                <label for="audit-username">Username</label>
                <input type="text" id="audit-username" name="username" required placeholder="e.g. Hikaru" />
              </div>
              <div class="field">
                <label for="audit-timeframe">Timeframe</label>
                <select id="audit-timeframe" name="timeframe">
                  <option value="1m">Last Month (Fast)</option>
                  <option value="3m" selected>Last 3 Months (Standard)</option>
                  <option value="6m">Last 6 Months</option>
                  <option value="12m">Last 12 Months</option>
                  <option value="all">All Available (Deep Audit)</option>
                </select>
              </div>
            </div>

            <div class="form-actions">
              <button type="submit" class="primary-btn">Search Games</button>
              <button type="button" id="analyze-all-btn" class="secondary-btn" style="display:none;">Analyze All
                Games</button>
            </div>
          </form>

          <!-- Batch Analysis Progress -->
          <div id="batch-progress" style="display:none; margin: 2rem 0;">
            <div class="progress-info">
              <span id="progress-label">Analyzing games...</span>
              <span id="progress-percentage">0%</span>
            </div>
            <div class="progress-bar-container">
              <div class="progress-bar-fill" id="progress-fill" style="width: 0%;"></div>
            </div>
            <div class="progress-footer">
              <span id="progress-current">Game 0 of 0</span>
            </div>
          </div>

          <p class="status" id="audit-status"></p>
        </div>

        <!-- Audit Results List -->
        <div id="audit-results" style="display:none;">
          <div class="results-header">
            <h3>Recent Public Games</h3>
          </div>
          <div class="table-wrapper">
            <table id="audit-table">
              <thead>
                <tr>
                  <th>Platform</th>
                  <th>White</th>
                  <th>Black</th>
                  <th>URL</th>
                  <th>Result</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Account Linking Section -->
      <section class="content-section" id="connection" style="display: none;">
        <header class="section-header">
          <h2>ğŸ”— Link Lichess Account</h2>
          <p class="section-desc">Sync your own games for automatic analysis</p>
        </header>

        <div class="card">
          <form id="connect-form">
            <div class="field">
              <label for="lichess-username">Lichess Username</label>
              <input type="text" id="lichess-username" name="lichessUsername" required />
            </div>
            <div class="field">
              <label for="lichess-token">OAuth / Personal Token</label>
              <input type="password" id="lichess-token" name="lichessToken" required />
              <small class="hint-text">
                Create a token in your <a href="https://lichess.org/account/oauth/app" target="_blank">settings</a>.
              </small>
            </div>
            <button type="submit">Connect Account</button>
          </form>
          <p class="status" id="connect-status"></p>
        </div>

        <div id="games" style="display: none; margin-top: 2rem;">
          <div class="card">
            <h3>2. Synchronise Your Games</h3>
            <div class="sync-controls">
              <label for="max-games">Max games</label>
              <input type="number" id="max-games" min="1" max="200" value="20" />
              <button id="sync-games" type="button">Sync Now</button>
            </div>
            <p class="status" id="games-status"></p>
            <div class="table-wrapper">
              <table id="games-table">
                <thead>
                  <tr>
                    <th>Game</th>
                    <th>White</th>
                    <th>Black</th>
                    <th>Result</th>
                    <th>Speed</th>
                    <th>Moves</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- Reports Section -->
      <section class="content-section" id="reports" style="display: none;">
        <header class="section-header">
          <h2>ğŸš¨ Safety Reports</h2>
          <p class="section-desc">Submit and track fair play reports</p>
        </header>

        <div class="card">
          <form id="report-form">
            <div class="form-grid">
              <div class="field">
                <label for="report-game">Game ID</label>
                <input type="text" id="report-game" name="gameId" required placeholder="e.g. abc123" />
              </div>
              <div class="field">
                <label for="report-player">Player Username</label>
                <input type="text" id="report-player" name="playerId" required />
              </div>
            </div>
            <div class="field">
              <label for="report-notes">Observations</label>
              <textarea id="report-notes" name="description" rows="3"
                placeholder="Describe the suspicious behaviour"></textarea>
            </div>
            <button type="submit">Submit Report</button>
          </form>
          <p class="status" id="report-status"></p>
        </div>

        <div class="reports-history" style="margin-top: 2rem;">
          <h3>Your Recent Reports</h3>
          <div id="reports-list"></div>
        </div>
      </section>

      <!-- Pricing Section -->
      <section class="content-section" id="pricing-section" style="display: none;">
        <header class="section-header">
          <h2>ğŸ’ Upgrade to Pro</h2>
          <p class="section-desc">Support fair play and unlock advanced detection</p>
        </header>

        <div class="pricing-grid">
          <div class="pricing-card">
            <div class="pricing-header">
              <h3>Free</h3>
              <div class="price">$0<span>/month</span></div>
            </div>
            <ul class="features">
              <li>âœ“ 5 game analyses per day</li>
              <li>âœ“ Basic suspicion detection</li>
              <li>âœ“ Detective Mode access</li>
            </ul>
            <button class="secondary" disabled>Active</button>
          </div>

          <div class="pricing-card premium">
            <div class="badge">RECOMMENDED</div>
            <div class="pricing-header">
              <h3>Pro</h3>
              <div class="price">$10<span>/month</span></div>
            </div>
            <ul class="features">
              <li>âœ“ Unlimited game analyses</li>
              <li>âœ“ Advanced ToM Score metrics</li>
              <li>âœ“ Move timing analysis</li>
              <li>âœ“ Batch analysis (Timeframe selection)</li>
              <li>âœ“ Ban status detection</li>
              <li>âœ“ Priority support</li>
            </ul>
            <button onclick="handleSubscribe()">Get Started</button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <section class="login-layout" id="login-layout">
    <div class="landing-page">
      <!-- Hero Section -->
      <header class="landing-hero">
        <div class="landing-logo-container" style="display: flex; justify-content: center; margin-bottom: 2rem;">
          <!-- Simple, standard Chess Knight -->
          <svg width="100" height="100" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
            <path fill="white"
              d="M127.9 32.5c-4.8 0-9.6.9-14.1 2.8-19.1 7.9-26.6 29.8-17.7 48.6l.8 1.8 28.6 60.5C92.9 143.6 57 186.2 57 236c0 36.4 15.6 57.3 35.8 77.2 16.4 16.2 37.5 29.5 59.8 45.4 0 0 10.3 7.4 10.3 21.4 0 9.6-6.4 17.5-12.8 24.5-9.2 10-18.4 19.9-15.5 35.8 1.8 9.8 8.8 17.9 18.2 21.2 9.5 3.3 20.2 1.4 28.1-5.1 19.4-15.9 31.9-46.1 55.4-60.8 15.6-9.8 33.6-13.8 51.5-11.5 17.1 2.2 33.4 9.4 46.9 20.5 7.8 6.4 18.5 7.9 27.6 3.9 9.1-4.1 15-13.2 15-23.1V262.2C377.3 135.2 265.9 32.5 127.9 32.5zm0 40c49.3 0 94.6 18.2 130.6 48.2-12-16.1-36.9-38.3-70.3-43.7-18.7-3-38.9.7-55.9 9.7-11.8 6.3-8.8-11.3-4.4-14.2Z" />
            <path fill="white" d="M120 280c-13.3 0-24 10.7-24 24s10.7 24 24 24 24-10.7 24-24-10.7-24-24-24z" />
          </svg>
        </div>
        <h1>Chess Observer</h1>
        <p class="landing-tagline">Know if you've played a cheater. Instantly.</p>
        <p class="landing-subtitle">AI-powered analysis scans your games and flags suspicious opponents â€” so you can
          focus on improving, not wondering.</p>
      </header>

      <!-- How It Works -->
      <section class="landing-section">
        <h2>How It Works</h2>
        <div class="feature-grid">
          <div class="feature-card">
            <span class="feature-icon">ğŸ”—</span>
            <h3>1. Connect</h3>
            <p>Link your Lichess or Chess.com account in one click. We never see your password.</p>
          </div>
          <div class="feature-card">
            <span class="feature-icon">ğŸ¤–</span>
            <h3>2. We Analyze</h3>
            <p>Our AI scans your recent games and compares opponent moves to engine recommendations.</p>
          </div>
          <div class="feature-card">
            <span class="feature-icon">ğŸš¨</span>
            <h3>3. Get Alerts</h3>
            <p>Suspicious players are flagged with detailed reports explaining <em>why</em> they look fishy.</p>
          </div>
        </div>
      </section>

      <!-- What We Detect -->
      <section class="landing-section dark-section">
        <h2>What We Detect</h2>
        <ul class="detect-list">
          <li>âœ“ <strong>Engine Correlation</strong> â€” Matches moves to Stockfish top choices</li>
          <li>âœ“ <strong>Move Timing Patterns</strong> â€” Detects robotic or suspiciously consistent timing</li>
          <li>âœ“ <strong>Sniper Moves</strong> â€” Finds only-move wins in losing positions</li>
          <li>âœ“ <strong>Ban History</strong> â€” Checks if opponent was already banned on Lichess/Chess.com</li>
          <li>âœ“ <strong>Theory of Mind Score</strong> â€” Measures how "human-like" the play feels</li>
        </ul>
      </section>

      <!-- Pricing Card -->
      <section class="landing-section">
        <h2>Simple Pricing</h2>
        <div class="pricing-card-container">
          <div class="pricing-card">
            <div class="pricing-badge">3-Day Free Trial</div>
            <div class="pricing-amount">
              <span class="currency">$</span>
              <span class="price">9</span>
              <span class="cents">.95</span>
              <span class="period">/month</span>
            </div>
            <p class="pricing-desc">Full access to all features. Cancel anytime.</p>
            <ul class="pricing-features">
              <li>âœ“ Unlimited game analysis</li>
              <li>âœ“ Real-time opponent scanning</li>
              <li>âœ“ Detailed cheat reports with explanations</li>
              <li>âœ“ Ban history lookups</li>
              <li>âœ“ Email alerts for flagged players</li>
              <li>âœ“ Chess.com + Lichess support</li>
            </ul>
            <button class="cta-button" id="subscribe-btn" onclick="startStripeCheckout()">
              Start Free Trial â†’
            </button>
            <p class="pricing-note">No credit card required for trial. Billed monthly after.</p>
          </div>
        </div>
      </section>

      <!-- Sign In -->
      <section class="landing-section sign-in-section">
        <h2>Ready to Get Started?</h2>
        <div class="card login-card" id="login-card">
          <div style="text-align: center; margin-bottom: 1.5rem;">
            <p class="text-muted">Sign in to start your free trial</p>
          </div>

          <div class="social-login">
            <button type="button" class="social-btn google" onclick="window.location.href='/api/auth/google/login'"
              style="font-family: Roboto, sans-serif;">
              <!-- Google G Logo -->
              <svg class="social-icon" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844a4.14 4.14 0 0 1-1.796 2.716v2.259h2.908c1.702-1.567 2.684-3.875 2.684-6.615z"
                  fill="#4285F4" fill-rule="evenodd"></path>
                <path
                  d="M9 18c2.43 0 4.467-.806 5.956-2.18l-2.908-2.259c-.806.54-1.836.86-3.048.86-2.344 0-4.328-1.584-5.036-3.715H.957v2.332A8.997 8.997 0 0 0 9 18z"
                  fill="#34A853" fill-rule="evenodd"></path>
                <path
                  d="M3.964 10.71A5.41 5.41 0 0 1 3.682 9c0-.593.102-1.17.282-1.71V4.958H.957A8.996 8.996 0 0 0 0 9c0 1.452.348 2.827.957 4.042l3.007-2.332z"
                  fill="#FBBC05" fill-rule="evenodd"></path>
                <path
                  d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0A8.997 8.997 0 0 0 .957 4.958L3.964 7.29C4.672 5.163 6.656 3.58 9 3.58z"
                  fill="#EA4335" fill-rule="evenodd"></path>
              </svg>
              Sign in with Google
            </button>
            <button type="button" class="social-btn apple" onclick="window.location.href='/api/auth/apple/login'"
              style="font-family: -apple-system, system-ui, sans-serif;">
              <!-- Apple Logo -->
              <svg class="social-icon" viewBox="0 0 384 512" xmlns="http://www.w3.org/2000/svg">
                <path fill="#FFF"
                  d="M318.7 268.7c-.2-36.7 16.4-64.4 50-84.8-18.8-26.9-47.2-41.7-84.7-44.6-35.5-2.8-74.3 20.7-88.5 20.7-15 0-49.4-19.7-76.4-19.7C63.3 141.2 4 184.8 4 273.5q0 39.3 14.4 81.2c12.8 36.7 59 126.7 107.2 125.2 25.2-.6 43-17.9 75.8-17.9 31.8 0 48.3 17.9 76.4 17.9 48.6-.7 90.4-82.5 102.6-119.3-65.2-30.7-61.7-90-61.7-91.9zm-56.6-164.2c27.3-32.4 24.8-61.9 24-72.5-24.1 1.4-52 16.4-67.9 34.9-17.5 19.8-27.8 44.3-25.6 71.9 26.1 2 52.3-11.4 69.5-34.3z" />
              </svg>
              Sign in with Apple
            </button>
          </div>

          <div class="divider">Questions?</div>

          <div style="text-align: center;">
            <a href="#help" onclick="document.getElementById('help-modal').style.display='block'"
              style="color: var(--text-muted); text-decoration: none; font-size: 0.9em;">How does Chess Observer
              work?</a>
          </div>

          <p class="status" id="login-status"></p>
        </div>
      </section>

      <!-- Footer -->
      <footer class="landing-footer">
        <p>Â© 2026 Chess Observer Â· <a href="mailto:support@chess.observer">support@chess.observer</a></p>
      </footer>
    </div>
  </section>


  <!-- Help / WikiHow Modal -->
  <div id="help-modal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 900px; height: 80vh; overflow-y: auto;">
      <span class="close-modal" onclick="document.getElementById('help-modal').style.display='none'">&times;</span>
      <div id="help-content"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="app.js" type="module"></script>
</body>

</html>