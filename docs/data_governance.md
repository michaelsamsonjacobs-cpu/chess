# ChessGuard Data Governance

This document summarises how the ChessGuard project acquires, stores, and
annotates chess games for cheat-detection research.  It complements the
operational notes in `data/README.md` and should be referenced by anyone working
with production datasets or training pipelines.

## Dataset Provenance

ChessGuard only ingests games from reputable providers with clear usage
policies.  The default registry in `chessguard/data/ingest.py` includes:

- **Lichess Masters PGN** – monthly snapshots of curated master-level games
  distributed via the [Lichess database](https://database.lichess.org/).  Files
  arrive as compressed PGN archives (`.pgn.bz2`).
- **Lichess JSON API** – authenticated requests to `https://lichess.org/api`
  that return game records in JSON (or JSONL) format.  These payloads include
  clock information and per-player metadata suitable for model features.

Each ingestion run records the download URL, timestamp, and checksum when
writing the raw snapshot.  Processed tables include these provenance fields so
that individual rows can always be traced back to their origin.  If additional
sources are introduced they must be registered via
`chessguard.data.ingest.register_trusted_source` with accompanying documentation
in this file.

## Labeling Criteria

Engine-based features are generated by
`chessguard/data/labeling.py`.  The default
`SimpleHeuristicEvaluator` examines SAN annotations (`?`, `??`, `!`) to estimate
average centipawn loss (CPL), blunder rate, and inaccuracy rate.  Human-style
labels are applied by `LabelingGuidelines` using the following logic:

1. Games shorter than 20 moves are marked `short_game` because the signal is too
   weak for reliable detection.
2. Games with a blunder rate higher than 8% are labelled `clean`—frequent
   blunders are incompatible with assisted play.
3. Games with average CPL ≤ 25 are labelled `suspicious` and should be reviewed
   by an analyst.
4. Games with average CPL ≤ 45 but above the suspicious threshold are labelled
   `review` for secondary triage.
5. Remaining games are labelled `clean`.

The thresholds are configurable via `LabelingGuidelines` and may be tuned during
model evaluation.  When human reviewers override a label they must record their
name and rationale in the `label_reason` field.

## Privacy and Compliance

- Only public games or games for which ChessGuard has contractual processing
  rights may be ingested.  API calls must respect each provider's terms of
  service and rate limits.
- Personally identifiable information (PII) such as email addresses or IP logs
  is never stored in analytics datasets.  The ingestion code automatically drops
  unknown fields; analysts must resist the temptation to join sensitive tables
  without legal approval.
- Raw downloads are retained for 180 days and stored in a restricted bucket
  (`data/raw/`).  Processed features and model artefacts in `data/processed/`
  and `data/artifacts/` inherit the retention periods outlined in `data/README.md`.
- Access to production datasets should be granted on a least-privilege basis.
  Every training run must archive its configuration and metrics alongside the
  exported model so that audits can reconstruct the decision process.

Adhering to these guidelines ensures that ChessGuard research remains compliant
with data-protection obligations while delivering reproducible results.
